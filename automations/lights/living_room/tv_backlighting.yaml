- id: living_room_tv_backlighting_every_automation
  alias: "Wohnzimmer - TV Backlighting umschalten"
  trigger:
    - platform: state
      entity_id: input_boolean.alarm_mode
    - platform: state
      entity_id: media_player.fernseher_wohnzimmer
    - platform: state
      entity_id: input_boolean.living_room_insect_light
    - platform: state
      entity_id: input_select.state_living_room
    - platform: state
      entity_id: input_select.state_dining_room
    - platform: state
      entity_id: input_select.state_house
  condition:
    - alias: "Wohnzimmerautomatisierungen nicht ausgeschaltet"
      condition: state
      entity_id: input_boolean.disable_living_room
      state: 'off'
  action:
    - alias: "Korrekte Beleuchtung ausw√§hlen"
      choose:
      #################################################################
      - conditions:
          - alias: "Alarm ist an"
            condition: state
            entity_id: input_boolean.alarm_mode
            state: "on"
        sequence:
          - service: switch.turn_off
            entity_id: switch.wled_tv_backlighting_lor
          - service: light.turn_on
            data:
              entity_id: light.living_room_tv_backlighting
              brightness_pct: 100
              rgb_color: [255, 0, 0]
          - service: wled.effect
            data:
              entity_id: light.living_room_tv_backlighting
              effect: "Chase"
              intensity: 255
              speed: 255
      #################################################################
      - conditions:
          - alias: "Fernseher ist an"
            condition: state
            entity_id: media_player.fernseher_wohnzimmer
            state: "on"
        sequence:
          - service: light.turn_on
            data:
              entity_id: light.living_room_tv_backlighting
              brightness_pct: 100
              hs_color: ['{{states("input_number.global_hue_primary")|float}}', 100]
          - service: wled.effect
            data:
              entity_id: light.living_room_tv_backlighting
              effect: "Candle Multi"
              intensity: 60
              speed: 20
          - service: switch.turn_on
            entity_id: switch.wled_tv_backlighting_lor
      #################################################################
      - conditions:
          - condition: or
            conditions:
            - alias: "Wohnzimmer ist An"
              condition: state
              entity_id: input_select.state_living_room
              state: "An"
            - alias: "Esszimmer ist An"
              condition: state
              entity_id: input_select.state_dining_room
              state: "An"
            - alias: "Wohnzimmer ist Bewohnt"
              condition: state
              entity_id: input_select.state_living_room
              state: "Bewohnt"
            - alias: "Esszimmer ist Bewohnt"
              condition: state
              entity_id: input_select.state_dining_room
              state: "Bewohnt"
          - alias: "Insektenlicht ist an"
            condition: state
            entity_id: input_boolean.living_room_insect_light
            state: "on"
          - alias: "Haus ist Bewohnt"
            condition: state
            entity_id: input_select.state_house
            state: "Bewohnt"
        sequence:
          - service: switch.turn_off
            entity_id: switch.wled_tv_backlighting_lor
          - service: light.turn_on
            data:
              entity_id: light.living_room_tv_backlighting
              brightness_pct: 70
              rgb_color: [255, 0, 0]
          - service: wled.effect
            data:
              entity_id: light.living_room_tv_backlighting
              effect: fire flicker
              intensity: 150
              speed: 255
      #################################################################
      - conditions:
          - condition: or
            conditions:
            - alias: "Wohnzimmer ist An"
              condition: state
              entity_id: input_select.state_living_room
              state: "An"
            - alias: "Esszimmer ist An"
              condition: state
              entity_id: input_select.state_dining_room
              state: "An"
            - alias: "Wohnzimmer ist Bewohnt"
              condition: state
              entity_id: input_select.state_living_room
              state: "Bewohnt"
            - alias: "Esszimmer ist Bewohnt"
              condition: state
              entity_id: input_select.state_dining_room
              state: "Bewohnt"
          - alias: "Haus ist Bewohnt"
            condition: state
            entity_id: input_select.state_house
            state: "Bewohnt"
        sequence:
          - service: switch.turn_off
            entity_id: switch.wled_tv_backlighting_lor
          - service: light.turn_on
            data:
              entity_id: light.living_room_tv_backlighting
              brightness_pct: 100
              hs_color: ['{{states("input_number.global_hue_primary")|float}}', 100]
          - service: wled.effect
            data:
              entity_id: light.living_room_tv_backlighting
              effect: "Candle Multi"
              intensity: 60
              speed: 20
      #################################################################
      default:
        - service: switch.turn_off
          entity_id: switch.wled_tv_backlighting_lor
        - service: light.turn_off
          data:
            entity_id:
              - light.living_room_tv_backlighting
